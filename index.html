<!DOCTYPE html>
<html lang="ko">

<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Our Winter</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<style>
  body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
    background: #f4f4f6;
    color: #333;
    padding-bottom: env(safe-area-inset-bottom);
  }

  /* ì¸íŠ¸ë¡œ ë¬¸ì¥ ìƒ‰ ê³ ì • */
  #intro {
    color: #000;   /* ê²€ì •ìƒ‰ */
  }

  /* ===== ì¸íŠ¸ë¡œ ===== */
  .center {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    
    background: #f4f4f6;
    z-index: 10;
  }

  .button-row {
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 16px;
    flex-wrap: nowrap;
  }

  button {
    padding: 10px 26px;
    border-radius: 20px;
    border: none;
    background: #e5e5e5;   /* ê¸°ì¡´ #ddd ë³´ë‹¤ ë°ê²Œ */
    cursor: pointer;
    font-size: 15px;
  }

  button:hover { background: #bbb; }

  /* ===== í™ˆ ===== */
  #home {
    padding: 0 16px;
    width: 100%;
    box-sizing: border-box;
  }
  .dday {
    background: #fff;
    border-radius: 14px;
    padding: 14px;
    margin: 12px 0 18px;
    text-align: center;

    width: 100%;               /* â­ í•µì‹¬ */
    box-sizing: border-box;    /* â­ padding í¬í•¨ */
  }

  /* ===== ìº˜ë¦°ë” ===== */
 .calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .days {
    margin-top: 10px;
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 6px;
    font-size: 12px;
    text-align: center;
  }

  .day {
    padding: 10px 0;
    border-radius: 6px;
    position: relative;
    cursor: default;
    font-size: 14px;
  }

  .mark {
    background: #e1ebff;
    font-weight: 600;
  }

  .day span {
    font-size: 10px;
    display: block;
  }

  /* ğŸŒ™ ë°¤ ëª¨ë“œ â€“ ì˜¤ë¥¸ìª½ ì¹´ë“œë“¤ */
  body.night .calendar-card,
  body.night .anniversary-card {
    background: #1b1f3a;
    color: #cfd3ff;
  }

  body.night #annivList li:hover {
    color: #ffffff;
  }

  body.night .calendar-card .days > div {
    color: #9aa3ff;
  }

  /* ===== Anniversary ===== */
  h3 {
    margin-top: 22px;
  }

  #annivList {
    list-style: none;
    padding: 0;
    margin: 8px 0;
  }

  #annivList li {
    margin-bottom: 6px;
    cursor: pointer;
  }

  #detail {
    margin-top: 12px;
    background: #f4f4f6;
    border-radius: 12px;
    padding: 12px;
  }

  body.night #detail {
    background: #2a2f5a;
  }
 
  #snow {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none; /* í´ë¦­ ë°©í•´ X */
  z-index: 5;
  }
  
  body.night {
  background: #0f1220;
  color: #cfd3ff;
  }
  
  body.night .dday,
  body.night #memoBox,
  body.night #detail {
    background: #1b1f3a;
    color: #e6e6f0;
  }
  
  #themeBtn {
    position: fixed;
    top: 14px;
    right: 14px;

    height: 36px;
    padding: 0 16px;          /* â† ì•Œì•½ í•µì‹¬ */
    border-radius: 999px;    /* â† ëˆ„ìš´ ì•Œì•½ */
    
    display: flex;
    align-items: center;
    justify-content: center;
    
    font-size: 18px;
    line-height: 1;
    
    background: #e5e5e5;     /* ë‚® ëª¨ë“œ */
    color: #333;
    
    border: none;
    cursor: pointer;
    z-index: 30;
  }
  
  /* ğŸŒ™ ë°¤ ëª¨ë“œ ìº˜ë¦°ë” ê¸°ë…ì¼ ê°€ë…ì„± ê°œì„  */
  body.night .day.mark {
    background: #2a2f5a;   /* ì–´ë‘ìš´ ë¸”ë£¨ */
    color: #ffffff;       /* ê¸€ì ì„ ëª…í•˜ê²Œ */
  }
  
  body.night .day.mark span {
    opacity: 0.9;
  }
  
  /* ğŸŒ™ ë°¤ ëª¨ë“œ â€“ ìº˜ë¦°ë” í™”ì‚´í‘œ ë²„íŠ¼ */
  body.night .calendar-header button {
    background: #2a2f5a;
    color: #ffffff;
    border: none;
  }
  
  /* hover ì‹œ ì‚´ì§ ë°ê²Œ */
  body.night .calendar-header button:hover {
    background: #3a4080;
  }

  /* âœ… ê¸°ë…ì¼(mark) ìˆëŠ” ë‚ ì§œë§Œ ë§í’ì„  í‘œì‹œ */
  .day.mark:hover::after {
    content: attr(data-text);
    position: absolute;
    left: 50%;
    bottom: -34px;
    transform: translateX(-50%);
    background: #333;
    color: #fff;
    padding: 4px 7px;
    border-radius: 6px;
    font-size: 10px;
    white-space: nowrap;
    z-index: 50;          /* â­ ê°€ë ¤ì§ ë°©ì§€ í•µì‹¬ */
  }
  
  .day.mark[data-text=""]::after {
    display: none;
  }
  
  input {
    font-size: 16px;
  }
  
  /* ===== í”„ë¡œí•„ ===== */
  .profile-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.4);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 20;
  }
  
  .profile-box {
    background: #fff;
    width: 90%;
    max-width: 320px;
    border-radius: 18px;
    padding: 16px;
    text-align: center;
    position: relative;
  }

  body.night .profile-box {
    background: #1b1f3a;
    color: #fff;
  }

  .profile-img {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    background: #ddd;
    margin: 0 auto 10px;
  }

  .hidden {
    display: none;
  }

  body.entered.night .button-row button {
    background: #2a2f5a;
    color: #ffffff;
  }

  body.entered.night .button-row button:hover {
    background: #3a4080;
  }

  body.night .profile-modal {
    background: rgba(0,0,0,0.6);
  }

  /* 1ï¸âƒ£ ì¸íŠ¸ë¡œ ë²„íŠ¼ì€ ë°¤ëª¨ë“œ ì˜í–¥ ë°›ì§€ ì•Šê²Œ */
  body.night #intro button {
    background: #ddd;
    color: #000;
  }

  /* 2ï¸âƒ£ ë°¤ ëª¨ë“œ â€“ ë©”ëª¨ ì „ì†¡ ë²„íŠ¼ */
  body.night .memo-input button {
    background: #2a2f5a;
    color: #ffffff;
  }

  body.night .memo-input button:hover {
    background: #3a4080;
  }

  /* âœ… ë‚® ëª¨ë“œ ê¸°ë³¸ X ë²„íŠ¼ */
  .profile-close-btn {
    position: absolute;
    top: 12px;
    right: 12px;

    height: 28px;
    padding: 0 14px;
    border-radius: 999px;   /* ëˆ„ìš´ ì•Œì•½ */

    background: #e5e5e5;    /* âœ… ë‚® ëª¨ë“œ ìƒ‰ */
    color: #333;

    border: none;
    font-size: 14px;
    cursor: pointer;
  }

  .profile-close-btn:hover {
    background: #ccc;
  }

  /* ğŸŒ™ ë°¤ ëª¨ë“œì—ì„œë§Œ ìƒ‰ ë³€ê²½ */
  body.night .profile-close-btn {
    background: #2a2f5a;
    color: #ffffff;
  }

  body.night .profile-close-btn:hover {
    background: #3a4080;
  }

  /* ===== ì±„íŒ… ì „ì²´ ===== */
  #chat {
    margin-top: 0;
    width: 100%;
    min-height: 420px;
    height: 55vh;   /* â­ í™”ë©´ ê¸°ì¤€ ë†’ì´ */
    max-height: 600px;

    background: #ffffff;
    border-radius: 18px;
    padding: 14px;

    display: flex;
    flex-direction: column;

    box-sizing: border-box;   /* â­ ì´ ì¤„ ì¶”ê°€ */
  }

  /* ë©”ì‹œì§€ ë¦¬ìŠ¤íŠ¸ */
  #messages {
    flex: 1;              /* â­ ë‚¨ì€ ê³µê°„ ë‹¤ ì°¨ì§€ */
    overflow-y: auto;
    padding: 6px 4px 10px;
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  /* ê³µí†µ ë©”ì‹œì§€ ë¸”ë¡ */
  .message {
    display: flex;
    flex-direction: column;
    max-width: 78%;
  }

  /* ì´ë¦„ */
  .message .name {
    font-size: 11px;
    margin-bottom: 4px;
    opacity: 0.55;
  }

  /* ë§í’ì„  */
  .bubble {
    background: #ffffff;                 /* ğŸ”¹ ë‘˜ ë‹¤ í°ìƒ‰ */
    padding: 10px 14px;
    border-radius: 16px;
    font-size: 14px;
    line-height: 1.45;
    word-break: break-word;
    box-shadow: 0 2px 6px rgba(0,0,0,0.06); /* ğŸ”¹ ë§í’ì„  ëŠë‚Œ */
  }

  /* ì‹œê°„ */
  .time {
    font-size: 11px;
    opacity: 0.45;
    margin-top: 4px;
  }

  /* ì„œì˜¬ â€“ ì™¼ìª½ */
  .left {
    align-self: flex-start;
  }

  .left .bubble {
    border-bottom-left-radius: 6px; /* ğŸ”¹ ì™¼ìª½ ê¼¬ë¦¬ ëŠë‚Œ */
  }

  /* í˜„ìš° â€“ ì˜¤ë¥¸ìª½ */
  .right {
    align-self: flex-end;
    text-align: right;
  }

  .right .bubble {
    border-bottom-right-radius: 6px; /* ğŸ”¹ ì˜¤ë¥¸ìª½ ê¼¬ë¦¬ ëŠë‚Œ */
  }

  /* ì…ë ¥ ì˜ì—­ */
  .chat-input {
    display: flex;
    gap: 6px;
    margin-top: 10px;
  }

  .chat-input select,
  .chat-input input {
    flex: 1;
    padding: 10px;
    border-radius: 14px;
    border: 1px solid #ddd;
    font-size: 14px;
  }

  .chat-input button {
    padding: 10px 16px;
    border-radius: 14px;
    border: none;
    background: #e5e5e5;
  }

  body.night #chat {
    background: #1b1f3a;
  }

  body.night .bubble {
    background: #2a2f5a;
    color: #ffffff;
  }

  body.night .right .bubble {
    background: #3a4080;
  }

  body.night .chat-input input,
  body.night .chat-input select {
    background: #2a2f5a;
    color: #ffffff;
    border: 1px solid #3a4080;
  }

  /* ğŸŒ™ ë°¤ ëª¨ë“œ â€“ ì±„íŒ… ë³´ë‚´ê¸° ë²„íŠ¼ */
  body.night .chat-input button {
    background: #2a2f5a;   /* í™ˆ ì¹´ë“œë“¤ê³¼ ê°™ì€ í†¤ */
    color: #ffffff;
  }

  body.night .chat-input button:hover {
    background: #3a4080;
  }

  /* ===== ë©”ì¸ ë ˆì´ì•„ì›ƒ ===== */
  #main-layout {
    display: flex;
    flex-direction: column;
    gap: 20px;
    max-width: 420px;
    margin: 0 auto;
    padding: 20px 16px 24px 16px;
  }

  #top-area {
    max-width: 420px;
    margin: 0 auto;
    padding: 24px 16px 0 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    text-align: center;
  }

  /* ===== ì˜¤ë¥¸ìª½ ë¬¶ìŒ (ìº˜ë¦°ë” + ì• ë‹ˆë²Œì„œë¦¬) ===== */
  #right-panel {
    display: flex;
    flex-direction: column;
    gap: 18px;

    align-items: flex-start;   /* â­ ì¹´ë“œ í­ ê³ ì • í•µì‹¬ */
  }

  /* ì¹´ë“œ ê³µí†µ ìŠ¤íƒ€ì¼ */
  .calendar-card,
  .anniversary-card {
    background: #ffffff;
    border-radius: 16px;
  }

  .calendar-card { padding: 16px; }
  .anniversary-card { padding: 8px 16px; }

  #galleryCard h3 {
    margin-top: 5px;
    margin-bottom: 5px;
  }

  /* ğŸŒ™ í™ˆ + ë°¤ ëª¨ë“œì¼ ë•Œë§Œ */
  body.night #themeBtn {
    background: #2a2f5a;
    color: #ffffff;
  }
  
  /* â­ ì¸íŠ¸ë¡œ í™”ë©´ì—ì„œëŠ” í…Œë§ˆ ë²„íŠ¼ í•­ìƒ ë‚®ëª¨ë“œ */
  #intro:not(.hidden) ~ #themeBtn {
    background: #e5e5e5;
    color: #333;
  }

  /* ğŸ”¹ ì±„íŒ… ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° (ìŠ¤í¬ë¡¤ì€ ìœ ì§€) */
  #messages {
    scrollbar-width: none;        /* Firefox */
    -ms-overflow-style: none;     /* IE, Edge */
  }

  #messages::-webkit-scrollbar {
    display: none;                /* Chrome, Safari */
  }

  /* ğŸ§Š ì¹´ë“œ ê³µí†µ ê·¸ë¦¼ì */
  .dday,
  #chat,
  .calendar-card,
  .anniversary-card {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }

  /* ğŸ©µ í”„ë¡œí•„ ë²„íŠ¼ ì¹´ë“œ */
  .profile-btn {
    background: #ffffff;
    border-radius: 20px;
    padding: 10px 26px;
    border: none;
    cursor: pointer;
    font-size: 15px;

    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* ì¹´ë“œ ê·¸ë¦¼ì */
  }

  .gallery-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  #galleryContent {
    margin-top: 15px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }

  #galleryContent img {
    width: calc(33.333% - 7px);
    height: 100px;
    object-fit: cover;
    border-radius: 10px;
  }

  /* ğŸ–¼ ê°¤ëŸ¬ë¦¬ ë‹«ê¸° X ë²„íŠ¼ */
  .gallery-close-btn {
    background: transparent;
    border: none;
    font-size: 20px;
    cursor: pointer;
    padding: 0;
    line-height: 1;
    color: #333;
  }

  .gallery-close-btn:hover {
    background: transparent;   /* â­ íšŒìƒ‰ ì œê±° */
  }

  /* ğŸŒ™ ë°¤ëª¨ë“œ */
  body.night .gallery-close-btn {
    color: #ffffff;
  }

  body.night .gallery-close-btn:hover {
    background: transparent;
  }

  .chat-input input {
    min-height: 40px;
  }

  @supports (-webkit-touch-callout: none) {
    body {
      padding-bottom: 80px;
    }
  }

  html, body {
    overscroll-behavior: none;
  }


</style>
</head>

<body>
<canvas id="snow"></canvas>

<!-- ===== ì¸íŠ¸ë¡œ ===== -->
<div id="intro" class="center">
  <h1 id="introText">ëˆˆì€ ì–¸ì œê¹Œì§€ë‚˜ ë‚´ë¦´ê¹Œ?</h1>
  <div class="button-row" id="introButtons">
    <button onclick="enterHome()">Yes</button>
    <button onclick="showNo()">No</button>
  </div>
</div>

<!-- ===== ìƒë‹¨ ì˜ì—­ ===== -->
<div id="top-area" class="hidden">
  <h2>Our Winter â„ï¸</h2>

  <div class="button-row">
   <button class="profile-btn" onclick="openProfile('b')">í•˜í˜„ìš°</button>
    <span style="font-size:18px;">ğŸ©µ</span>
    <button class="profile-btn" onclick="openProfile('a')">í•œì„œì˜¬</button>
  </div>
  <div class="dday" id="ddayBox"></div>
</div>

<button id="themeBtn" onclick="toggleTheme()">ğŸŒ™</button>

<!-- ===== ë©”ì¸ ë ˆì´ì•„ì›ƒ ===== -->
<div id="main-layout" class="hidden">
  <!-- ğŸ“… ìº˜ë¦°ë” ì¹´ë“œ -->
  <div class="calendar-card">
    <div class="calendar-header">
      <button onclick="moveMonth(-1)">&lt;</button>
      <strong id="monthTitle"></strong>
      <button onclick="moveMonth(1)">&gt;</button>
    </div>
    <div class="days" id="calendar"></div>
  </div>
  
  <!-- ğŸ–¼ ê°¤ëŸ¬ë¦¬ ì¹´ë“œ -->
  <div class="anniversary-card hidden" id="galleryCard">
    <div class="gallery-header">
      <h3 id="galleryTitle">Gallery</h3>
      <button class="gallery-close-btn" onclick="closeGallery()">â¨‰</button>
    </div>
    <div id="galleryContent"></div>
  </div>

  <!-- ğŸ’¬ ì±„íŒ… ì¹´ë“œ -->
  <div id="chat">
    <div id="messages"></div>
    
    <div class="chat-input">
      <select id="sender">
        <option value="ì„œì˜¬">ì„œì˜¬</option>
        <option value="í˜„ìš°">í˜„ìš°</option>
      </select>
      
      <input
        id="messageInput"
        placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì¤˜â€¦"
        onkeydown="if(event.key==='Enter') sendMessage()"
      />
      
      <button onclick="sendMessage()">ë³´ë‚´ê¸°</button>
    </div>
  </div>

</div>
  
<div id="profileModal" class="profile-modal hidden" onclick="closeProfile()">
  <div class="profile-box" onclick="event.stopPropagation()">
    <button class="profile-close-btn" onclick="closeProfile()">X</button>
    <div id="profileContent"></div>
  </div>
</div>


<script>
  /* ===== ê¸°ë³¸ ë‚ ì§œ ===== */
  const startDate = new Date(2023, 1, 17); // 2023-02-17 = 1ì¼
  const birthdays = [
    { m: 10, d: 30, text: "ğŸ‚ ì„œì˜¬ ìƒì¼" },
    { m: 6, d: 3, text: "ğŸ‚ í˜„ìš° ìƒì¼" }
  ];

  let current = new Date();

  /* ===== ì¸íŠ¸ë¡œ ===== */
  function enterHome() {
    document.getElementById("intro").classList.add("hidden");
    document.body.classList.add("entered");
    document.getElementById("top-area").classList.remove("hidden");
    document.getElementById("main-layout").classList.remove("hidden");

    // â­ ìˆœì„œ ì¤‘ìš”
    updateDday();

    current = new Date();   // â† í˜„ì¬ ë‹¬ ê°•ì œ ì´ˆê¸°í™”
    renderCalendar();       // â† ë¬´ì¡°ê±´ í•œ ë²ˆ ê·¸ë¦¬ê¸°
  }

  function showNo() {
    const text = document.getElementById("introText");
    const buttons = document.getElementById("introButtons");

    // 1ï¸âƒ£ ë¬¸ì¥ ë³€ê²½
    text.textContent = "ëˆˆì€ ê²°êµ­ ë…¹ì•„ë²„ë ¤.";

    // 2ï¸âƒ£ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
    buttons.style.display = "none";

    // 3ï¸âƒ£ 3ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µêµ¬
    setTimeout(() => {
      text.textContent = "ëˆˆì€ ì–¸ì œê¹Œì§€ë‚˜ ë‚´ë¦´ê¹Œ?";
      buttons.style.display = "flex"; // ë‹¤ì‹œ ë³´ì´ê²Œ
    }, 3000);
  }

  /* ===== D-Day ===== */
  function updateDday() {
    const today = new Date();
    const days = Math.floor((today - startDate) / 86400000) + 1;
    document.getElementById("ddayBox").innerHTML =
      `<strong>D+${days}</strong><br>ëˆˆì´ ë‚´ë¦° ì§€ ${days}ì¼`;
  }

  /* ===== ìº˜ë¦°ë” ì´ë™ ===== */
  function moveMonth(diff) {
    current.setMonth(current.getMonth() + diff);
    renderCalendar();
  }

  /* ===== ìº˜ë¦°ë” ë Œë” ===== */
  function renderCalendar() {
    const cal = document.getElementById("calendar");

    const y = current.getFullYear();
    const m = current.getMonth();

    document.getElementById("monthTitle").innerText = `${y}ë…„ ${m + 1}ì›”`;

    let html = "";   // â­ í•µì‹¬

    // ìš”ì¼
    "ì¼ì›”í™”ìˆ˜ëª©ê¸ˆí† ".split("").forEach(d => {
      html += `<div>${d}</div>`;
    });

    const firstDay = new Date(y, m, 1).getDay();
    const lastDate = new Date(y, m + 1, 0).getDate();

    // ì• ë¹ˆì¹¸
    for (let i = 0; i < firstDay; i++) {
      html += `<div></div>`;
    }

    // ë‚ ì§œ
    for (let d = 1; d <= lastDate; d++) {
      const cellDate = new Date(y, m, d);
      let label = "";
      let icon = "";

      if (cellDate.getTime() === startDate.getTime()) {
        label = "ğŸ©µ ëˆˆì´ ë‚´ë¦¬ê¸° ì‹œì‘í•œ ";
        icon = "ğŸ©µ";
      }

      birthdays.forEach(b => {
        if (b.m === m && b.d === d) {
          label = b.text;
          icon = "ğŸ‚";
        }
      });

      const days = Math.floor((cellDate - startDate) / 86400000) + 1;
      if (days > 1 && days % 100 === 0) {
        label = `â„ï¸ ${days}ì¼`;
        icon = "â„ï¸";
      }

      if (
        cellDate.getDate() === startDate.getDate() &&
        cellDate.getMonth() === startDate.getMonth() &&
        cellDate.getFullYear() > startDate.getFullYear()
      ) {
        const yearDiff = cellDate.getFullYear() - startDate.getFullYear();
        label = `ğŸ’ ${yearDiff}ì£¼ë…„`;
        icon = "ğŸ’";
      }

      const dateString = `${y}-${String(m + 1).padStart(2, "0")}-${String(d).padStart(2, "0")}`;

      html += `
        <div class="day ${label ? "mark" : ""}"
          data-text="${label}"
          onclick="openGallery('${dateString}')">
          ${d}
          <span>${icon}</span>
        </div>
      `;
    }

    // â­ ë§ˆì§€ë§‰ì— í•œ ë²ˆë§Œ ë Œë”ë§
    cal.innerHTML = html;
  }


  /* ===== ëˆˆ íš¨ê³¼ ===== */
  const canvas = document.getElementById("snow");
  const ctx = canvas.getContext("2d");

  let w, h;
  let snowflakes = [];
  let snowCount = 60;      // ê¸°ë³¸ ëˆˆ ê°œìˆ˜
  let snowSpeed = 0.4;      // ê¸°ë³¸ ì†ë„

  function resizeSnow() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
  }
  window.addEventListener("resize", resizeSnow);
  resizeSnow();

  function createSnow() {
    snowflakes = [];
    for (let i = 0; i < snowCount; i++) {
      snowflakes.push({
        x: Math.random() * w,
        y: Math.random() * h,
        r: Math.random() * 4 + 1,              // í¬ê¸° ë‹¤ì–‘í™”
        speed: Math.random() * 1.5 + 0.3,     // â­ ê°ì ë‹¤ë¥¸ ì†ë„
        drift: Math.random() * 2 - 1,         // ì¢Œìš° ë°”ëŒ
        opacity: Math.random() * 0.5 + 0.4    // íˆ¬ëª…ë„ ë‹¤ì–‘í™”
      });
    }
  }

  createSnow();

  function drawSnow() {
    ctx.clearRect(0, 0, w, h);

    snowflakes.forEach(f => {
      ctx.beginPath();
      ctx.fillStyle = `rgba(255,255,255,${f.opacity})`;
      ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
      ctx.fill();
    });

    moveSnow();
  }

  function moveSnow() {
    snowflakes.forEach(f => {

      // ê¸°ë³¸ ë‚™í•˜
      f.y += f.speed * snowSpeed;

      // ë°”ëŒ + ë¶ˆê·œì¹™ í”ë“¤ë¦¼
      f.x += Math.sin(f.y * 0.01) * f.drift + (Math.random() - 0.5) * 0.5;

      // í™”ë©´ ë²—ì–´ë‚˜ë©´ ì¬ìƒì„±
      if (f.y > h) {
        f.y = -10;
        f.x = Math.random() * w;
        f.speed = Math.random() * 1.5 + 0.3;   // ë‹¤ì‹œ ëœë¤ ì†ë„
      }
    });
  }


  function animateSnow() {
    drawSnow();
    requestAnimationFrame(animateSnow);
  }
  animateSnow();


  /* í…Œë§ˆ */
  function toggleTheme() {
    document.body.classList.toggle("night");
    const isNight = document.body.classList.contains("night");
    localStorage.setItem("theme", isNight ? "night" : "day");
    document.getElementById("themeBtn").textContent = isNight ? "â˜€ï¸" : "ğŸŒ™";
  }

  const savedTheme = localStorage.getItem("theme");
  if (savedTheme === "night") {
    document.body.classList.add("night");
    document.getElementById("themeBtn").textContent = "â˜€ï¸";
  }

  /* âœ… í”„ë¡œí•„ */
  function openProfile(who) {
    const box = document.getElementById("profileModal");
    const content = document.getElementById("profileContent");
    
    if (who === "a") {
      content.innerHTML = `
        <div class="profile-img"></div>
        <h3>í•œì„œì˜¬</h3>
        <p>ì„¸ê³„ì˜ ì¢…ë§, ë„¤ ì•ì—ì„œ<br>#ë„¤ê°€ë¶€ë””_ë‚˜ë¥¼</p>
      `;
    }
    else {
      content.innerHTML = `
        <div class="profile-img"></div>
        <h3>í•˜í˜„ìš°</h3>
        <p>ì„¸ê³„ì˜ ì¢…ë§, ê·¸ ì•ì—ì„œ<br>#ë‚´ê°€ê°íˆ_ë„ˆë¥¼</p>
      `;
    }
    
    box.classList.remove("hidden");
  }

  function closeProfile() {
    document.getElementById("profileModal").classList.add("hidden");
  }
 
  const firebaseConfig = {
    apiKey: "ì•„ë¬´ê±°ë‚˜",
    authDomain: "our-winter-chat.firebaseapp.com",
    databaseURL: "https://our-winter-chat-default-rtdb.firebaseio.com",
    projectId: "our-winter-chat",
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  function sendMessage() {
    const text = document.getElementById("messageInput").value.trim();
    const user = document.getElementById("sender").value;
    if (!text) return;

    const now = Date.now();

    db.ref("messages").push({
      user: user,
      text: text,
      time: now,
      read: false
    });

    document.getElementById("messageInput").value = "";
  }

  const messagesDiv = document.getElementById("messages");

  db.ref("messages").limitToLast(200).on("value", (snapshot) => {
    messagesDiv.innerHTML = "";

    snapshot.forEach((child) => {
      const key = child.key;
      const { user, text, time, read } = child.val();

      const date = new Date(time);
      const month = date.getMonth() + 1;
      const day = date.getDate();
      const hour = date.getHours().toString().padStart(2, "0");
      const min = date.getMinutes().toString().padStart(2, "0");

      const msg = document.createElement("div");
      const side = user === "ì„œì˜¬" ? "left" : "right";
      msg.className = `message ${side}`;

      msg.innerHTML = `
      <div class="name">${user}</div>
      <div class="bubble">${text}</div>
      <div class="time">${month}ì›” ${day}ì¼ ${hour}:${min}</div>
      `;

      /* ğŸ’¡ ë§í’ì„  í´ë¦­ â†’ ì‚­ì œ */
      msg.querySelector(".bubble").onclick = () => {
        const ok = confirm("ì´ ë©”ì‹œì§€ë¥¼ ì‚­ì œí• ê¹Œ?");
        if (ok) {
          db.ref("messages/" + key).remove();
        }
      };

      messagesDiv.appendChild(msg);

      if (!read) {
        db.ref("messages/" + key + "/read").set(true);
      }
    });
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  });


// ë‚ ì§œ í´ë¦­í–ˆì„ ë•Œ ì‹¤í–‰
function openGallery(dateString) {
  const galleryCard = document.getElementById("galleryCard");
  const galleryContent = document.getElementById("galleryContent");
  const title = document.getElementById("galleryTitle");

  galleryContent.innerHTML = "";

  const [year, month, day] = dateString.split("-");
  title.textContent = `${year}ë…„ ${Number(month)}ì›” ${Number(day)}ì¼`;

  let found = false;

  // ìµœëŒ€ 10ì¥ê¹Œì§€ ìë™ íƒìƒ‰
  for (let i = 1; i <= 10; i++) {
    const img = new Image();
    img.src = `images/${dateString}_${i}.jpg`;

    img.onload = function () {
      galleryContent.appendChild(img);
      found = true;
    };
  }

  // 0.3ì´ˆ í›„ ì•„ë¬´ê²ƒë„ ì—†ìœ¼ë©´ ì•ˆë‚´ ë¬¸êµ¬
  setTimeout(() => {
    if (!found) {
      galleryContent.innerHTML = "<p>ì´ ë‚ ì˜ ì¶”ì–µì€ ì•„ì§ ì—†ì–´ìš” ğŸ¤</p>";
    }
  }, 300);

  galleryCard.classList.remove("hidden");
}

// ë‹«ê¸° ë²„íŠ¼
function closeGallery() {
  document.getElementById("galleryCard").classList.add("hidden");
}

  
</script>
</body>
</html>
